{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChangpleAI</title>
    {% if user.is_authenticated %}
    <link rel="stylesheet" href="{% static 'css/index_unlocked.css' %}">
    {% else %}
    <link rel="stylesheet" href="{% static 'css/index_locked.css' %}">
    {% endif %}
</head>
<body>
    <div class="container">
        <div class="header">
            {% if user.is_authenticated %}
            <!-- Logged in: Show My Page button -->
            <div class="mypage-btn" onclick="location.href='{% url 'profile' %}'">
                <svg class="mypage-icon" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.24279 6.8065C9.09527 6.8065 9.91284 6.46786 10.5156 5.86506C11.1184 5.26226 11.4571 4.4447 11.4571 3.59222C11.4571 2.73973 11.1184 1.92217 10.5156 1.31937C9.91284 0.716577 9.09527 0.37793 8.24279 0.37793C7.39031 0.37793 6.57274 0.716577 5.96994 1.31937C5.36715 1.92217 5.0285 2.73973 5.0285 3.59222C5.0285 4.4447 5.36715 5.26226 5.96994 5.86506C6.57274 6.46786 7.39031 6.8065 8.24279 6.8065ZM0.742787 16.4494C0.742787 15.4644 0.936781 14.4892 1.31369 13.5792C1.6906 12.6693 2.24305 11.8425 2.93949 11.1461C3.63593 10.4496 4.46272 9.89717 5.37266 9.52026C6.2826 9.14335 7.25787 8.94936 8.24279 8.94936C9.2277 8.94936 10.203 9.14335 11.1129 9.52026C12.0229 9.89717 12.8496 10.4496 13.5461 11.1461C14.2425 11.8425 14.795 12.6693 15.1719 13.5792C15.5488 14.4892 15.7428 15.4644 15.7428 16.4494H0.742787Z" fill="#889DC4"/>
                </svg>
                <div class="mypage-btn-text">마이 페이지</div>  
            </div>
            {% else %}
            <!-- Not logged in: Show Naver Login button -->
            <div class="login-btn" onclick="location.href='{% url 'naver_login' %}'">
                <svg class="naver-icon" xmlns="http://www.w3.org/2000/svg" width="17" height="16" viewBox="0 0 17 16" fill="none">
                    <path d="M11.8212 8.56186L5.88885 0.0664062H0.973938V15.9211H6.12674V7.43886L12.059 15.9211H16.9739V0.0664062H11.8212V8.56186Z" fill="#03C75A"/>                    
                </svg>
                <div class="login-btn-text">네이버 로그인</div>
            </div>
            {% endif %}

            <!-- Payment button (always shown) -->
            <div class="payment-btn">
                <svg class="payment-icon" width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11.7339 0.200195L13.2023 7.40581L18.9589 2.82986L15.452 9.29355L22.8032 9.48839L15.962 12.1857L21.4681 17.0602L14.4936 14.7291L15.5782 22.0023L11.7339 15.7335L7.88962 22.0023L8.97425 14.7291L1.9998 17.0602L7.50585 12.1857L0.664688 9.48839L8.01582 9.29355L4.50899 2.82986L10.2655 7.40581L11.7339 0.200195Z" fill="#889DC4"/>
                </svg>
                <div class="payment-btn-text">유료플랜 결제</div>
            </div>
        </div>

        <div class="main-content">
            <div class="title">창플AI 입니다. 무엇을 도와드릴까요?</div>
            
            <div class="suggestions">
                <div class="suggestion-box">카페 창업시 준비해야 할 기본적인 것들은 무엇이 있나요?</div>
                <div class="suggestion-box">창플의 창업 철학에 대해 궁금하신가요?</div>
                <div class="suggestion-box">문정동에서 소규모 창업을 하려는데, 구체적인 창업 비용과 항목 별 금액도 알 수 있나요?</div>
            </div>

            {% if user.is_authenticated %}
            <!-- Input unlocked for logged in users -->
            <div class="input-container-unlocked">
                <input type="text" class="input-box-unlocked" placeholder="창업의 모든 것을 물어보세요" />
                
                <!-- Changple icon (when input is empty) -->
                <div class="changple-btn">
                    <svg class="changple-icon" width="30" height="34" viewBox="0 0 30 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.0019 26.0245C18.6708 26.0245 20.3233 25.6958 21.8651 25.0572C23.4069 24.4186 24.8078 23.4825 25.9879 22.3024C27.1679 21.1224 28.104 19.7215 28.7427 18.1796C29.3813 16.6378 29.71 14.9853 29.71 13.3165C29.71 11.6476 29.3813 9.99512 28.7427 8.4533C28.104 6.91149 27.1679 5.51056 25.9879 4.33051C24.8078 3.15045 23.4069 2.21438 21.8651 1.57574C20.3233 0.937102 18.6708 0.608398 17.0019 0.608398L17.0019 13.3165L17.0019 26.0245Z" fill="#90A4C8"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17 0.608398H0.290001V33.8249H17V26.0245C17 26.0245 17 26.0245 17 26.0245L17 13.3165V0.608402C17 0.608402 17 0.608398 17 0.608398ZM17 0.608398V26.0245C15.3312 26.0245 13.6787 25.6958 12.1369 25.0572C10.5951 24.4186 9.19414 23.4825 8.01408 22.3024C6.83403 21.1224 5.89796 19.7215 5.25932 18.1796C4.62068 16.6378 4.29197 14.9853 4.29197 13.3165C4.29197 11.6476 4.62068 9.99512 5.25932 8.45331C5.89796 6.91149 6.83403 5.51056 8.01408 4.33051C9.19413 3.15046 10.5951 2.21439 12.1369 1.57575C13.6787 0.937108 15.3312 0.608401 17 0.608398Z" fill="#90A4C8"/>
                    </svg>
                </div>

                <!-- Send button -->
                <div class="send-btn">
                    <svg class="send-icon" width="23" height="26" viewBox="0 0 23 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.03659 12.7966C0.741862 12.5018 0.576294 12.102 0.576294 11.6852C0.576294 11.2683 0.741862 10.8685 1.03659 10.5737L10.4693 1.14096C10.7641 0.846232 11.1639 0.680664 11.5808 0.680664C11.9977 0.680664 12.3975 0.846232 12.6923 1.14096L22.125 10.5737C22.4114 10.8702 22.5698 11.2673 22.5662 11.6795C22.5627 12.0917 22.3973 12.486 22.1058 12.7775C21.8143 13.069 21.42 13.2343 21.0078 13.2379C20.5956 13.2415 20.1985 13.083 19.902 12.7966L13.1529 6.04754V24.2621C13.1529 24.679 12.9873 25.0789 12.6924 25.3738C12.3976 25.6686 11.9977 25.8342 11.5808 25.8342C11.1638 25.8342 10.764 25.6686 10.4691 25.3738C10.1743 25.0789 10.0087 24.679 10.0087 24.2621V6.04754L3.25956 12.7966C2.96475 13.0914 2.56495 13.2569 2.14808 13.2569C1.73121 13.2569 1.3314 13.0914 1.03659 12.7966Z" fill="#617DAE"/>
                    </svg>
                </div>
            </div>
            {% else %}
            <!-- Input locked for non-logged in users -->
            <div class="input-container-locked">
                <div class="input-box-locked">우측 상단에서 로그인 후 이용해 주세요.</div>
                <div class="locked-btn">
                    <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="27" height="30" viewBox="0 0 27 30" fill="none">
                        <path d="M13.4574 19.9639V22.9639M4.4574 28.9639H22.4574C23.253 28.9639 24.0161 28.6478 24.5787 28.0852C25.1413 27.5226 25.4574 26.7595 25.4574 25.9639V16.9639C25.4574 16.1682 25.1413 15.4052 24.5787 14.8425C24.0161 14.2799 23.253 13.9639 22.4574 13.9639H4.4574C3.66175 13.9639 2.89869 14.2799 2.33608 14.8425C1.77347 15.4052 1.4574 16.1682 1.4574 16.9639V25.9639C1.4574 26.7595 1.77347 27.5226 2.33608 28.0852C2.89869 28.6478 3.66175 28.9639 4.4574 28.9639ZM19.4574 13.9639V7.96387C19.4574 6.37257 18.8253 4.84644 17.7 3.72123C16.5748 2.59601 15.0487 1.96387 13.4574 1.96387C11.8661 1.96387 10.34 2.59601 9.21476 3.72123C8.08954 4.84644 7.4574 6.37257 7.4574 7.96387V13.9639H19.4574Z" stroke="#90A4C8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="help-btn">?</div>

        <div class="footer">
            <div class="company-info">(주)창플 | 283-88-00641 | 한범구 | 서울 송파구 송파대로 167 (문정동)테라타워 B동, 707호 | 02-2054-3956 | tiger9@changple.com</div>
            <div class="copyright">@Copyright @ ChangpleTeamBusiness Inc. All Rights Reserved.</div>
            <div class="privacy-policy">개인정보처리방침</div>
        </div>
    </div>

    {% if user.is_authenticated %}
    <script src="{% static 'js/index.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inputBox = document.querySelector('.input-box-unlocked');
            const sendBtn = document.querySelector('.send-btn');
            const changpleBtn = document.querySelector('.changple-btn');
            
            // Show/hide the appropriate button based on input content
            inputBox.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    changpleBtn.style.display = 'none';
                    sendBtn.style.display = 'flex';
                } else {
                    changpleBtn.style.display = 'flex';
                    sendBtn.style.display = 'none';
                }
            });
            
            // Trigger input event to set initial state
            inputBox.dispatchEvent(new Event('input'));
            
            // Send button click event
            sendBtn.addEventListener('click', function() {
                sendChatMessage();
            });
            
            // Enter key press event
            inputBox.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Message sending function
            function sendChatMessage() {
                const message = inputBox.value.trim();
                if (message) {
                    // Redirect to chat view with the message
                    window.location.href = `/chatbot/chat-view/?message=${encodeURIComponent(message)}`;
                }
            }
            
            // Make suggestion boxes clickable
            const suggestionBoxes = document.querySelectorAll('.suggestion-box');
            suggestionBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    inputBox.value = this.textContent;
                    inputBox.dispatchEvent(new Event('input'));
                });
            });
        });
    </script>
    {% endif %}
</body>
</html>
