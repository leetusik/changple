{% extends 'sidebar.html' %}
{% load static %}

{% block title %}ChangpleAI{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="icon" href="{% static 'img/favicon.svg' %}" type="image/x-icon">
{% endblock %}

{% block content %}
    <!-- Mobile message -->
    <div class="mobile-message">
        <p>모바일 접속을 지원하지 않습니다.</p>
        <p>PC로 접속하여 사용해주세요.</p>
    </div>

    <div class="header">
        <!-- 창플 메인 로고(좌측)) -->
        <div class="cp-logo-container" id="cp-logo" style="cursor: pointer;">
            <div class="cp-logo">
                {% comment %} <img src="{% static '../static/img/cp-logo-main.svg' %}" alt="CHAI Logo" /> {% endcomment %}
                <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 513.51 109.45">
                    <defs>
                        <style>
                        .cls-1 {
                            fill: #617dae;
                        }
                        </style>
                    </defs>
                    <path class="cls-1" d="M49.86,0v77.68c21.2,0,38.38-17.39,38.38-38.84S71.06,0,49.86,0Z"/>
                    <path class="cls-1" d="M11.48,38.84C11.48,17.39,28.67,0,49.86,0H0v100.73h49.86v-23.05c-21.2,0-38.38-17.39-38.38-38.84Z"/>
                    <path class="cls-1" d="M418.07,19.7c-3.19-2.75-7.01-4.12-11.48-4.12h-23.79v42.12h7.53v-14.02h16.26c2.93,0,5.65-.63,8.16-1.89s4.49-2.98,5.93-5.15c1.44-2.17,2.16-4.51,2.16-7.04,0-3.85-1.59-7.15-4.78-9.9h.01ZM411.16,37.45c-2.81,2.19-6.2,3.28-10.15,3.28h-10.67v-22.21h10.67c3.95,0,7.34,1.08,10.15,3.25s4.22,4.78,4.22,7.82-1.41,5.67-4.22,7.85h0Z"/>
                    <polygon class="cls-1" points="438.15 15.58 430.61 15.58 430.61 57.7 469.12 57.7 469.12 54.78 438.15 54.78 438.15 15.58"/>
                    <polygon class="cls-1" points="513.51 18.52 513.51 15.58 475 15.58 475 57.7 513.51 57.7 513.51 54.78 482.54 54.78 482.54 37.48 513.04 37.48 513.04 34.56 482.54 34.56 482.54 18.52 513.51 18.52"/>
                    <path class="cls-1" d="M123.82,28.07c.79-1.43,5.71-10.8,17-8.79.42.08.86.16,1.33.27,1.96.49,6.48,2.37,10.3,6.07l4.53-3.85c-2.28-1.96-4.9-3.49-7.85-4.57-2.95-1.08-6.1-1.62-9.45-1.62-6.74,0-12.5,2.06-17.27,6.17-4.77,4.11-7.15,9.08-7.15,14.89s2.38,10.78,7.15,14.89c4.77,4.11,10.52,6.17,17.27,6.17,3.35,0,6.5-.54,9.45-1.62,2.95-1.08,5.57-2.61,7.85-4.57l-2.44-3.34c-9.36,9.97-19.63,5.71-21.96,4.34-.17-.11-.34-.2-.5-.31-4.35-2.97-7.14-6.44-8.72-11.7-.98-3.61-1.22-5.31-.73-8.46.23-1.47.64-2.75,1.2-3.95v-.02Z"/>
                    <polygon class="cls-1" points="199.14 34.2 171.93 34.2 171.93 15.58 164.4 15.58 164.4 57.7 171.93 57.7 171.93 37.48 199.14 37.48 199.14 57.7 206.68 57.7 206.68 15.58 199.14 15.58 199.14 34.2"/>
                    <path class="cls-1" d="M236.07,15.58l-22.67,42.12h3.59l5.79-10.83,27.85-.29,6.18,11.12h8.3l-22.67-42.12h-6.37,0ZM224.52,43.68l12.38-22.99,12.38,22.99h-24.76Z"/>
                    <path class="cls-1" d="M346.07,36.64v3.06h14.57v11.19l-.84.47c-8.17,5.52-16.04,1.61-18.07.42-.17-.11-.34-.2-.5-.31-1.92-1.31-3.56-2.6-4.94-4.06-1.87-2.12-3.18-4.4-3.92-6.85,0-.03-.02-.05-.03-.07v-.03c-.55-1.97-.86-3.86-.96-5.68,0-.84.08-1.71.24-2.75.23-1.47.64-2.75,1.2-3.95.79-1.43,6.17-10.33,17.46-8.32.42.08.86.16,1.33.27,1.96.49,6.01,1.9,9.84,5.6l4.53-3.85c-1.5-1.29-3.16-2.38-4.95-3.29v-.02c-.13-.07-.26-.12-.39-.18-.24-.12-.48-.23-.72-.34-.43-.19-.86-.37-1.29-.54-.17-.06-.32-.14-.49-.2-.16-.06-.33-.1-.49-.16-.44-.15-.89-.29-1.34-.42-.29-.08-.58-.16-.87-.23-.47-.12-.95-.22-1.43-.31-.26-.05-.51-.1-.77-.14-.58-.09-1.17-.17-1.76-.22-.21-.02-.42-.04-.63-.05-.71-.05-1.43-.09-2.16-.09h0c-.71,0-1.4.03-2.09.08-.28.02-.55.04-.83.07-.34.03-.67.08-1,.12-4.01.52-7.62,1.86-10.84,4.01-.08.05-.17.11-.25.16-.63.43-1.25.9-1.85,1.4-.27.22-.54.45-.8.69-.57.51-1.11,1.04-1.61,1.58-.07.07-.13.15-.2.22-2.5,2.78-4.05,5.89-4.65,9.35-.05.28-.1.57-.14.85-.03.24-.06.48-.08.72-.06.59-.09,1.19-.09,1.8,0,5.82,2.38,10.78,7.15,14.89s10.52,6.17,17.27,6.17h0c.99,0,1.95-.06,2.9-.16.25-.02.49-.06.73-.09.74-.09,1.47-.21,2.19-.36.23-.05.46-.1.68-.15.81-.19,1.62-.42,2.4-.69.11-.04.22-.06.32-.1.07-.03.15-.04.23-.07.82-.3,1.61-.64,2.38-1.01.06-.03.12-.04.17-.07v.03h7.54v-18.38h-22.15Z"/>
                    <polygon class="cls-1" points="308.83 34.2 308.83 37.48 308.83 52.98 278.6 15.59 278.6 15.58 271.06 15.58 271.06 57.7 278.6 57.7 278.6 37.48 278.6 34.2 278.6 20.76 308.46 57.7 312.64 57.7 312.64 57.7 316.36 57.7 316.36 15.58 308.83 15.58 308.83 34.2"/>
                    <path class="cls-1" d="M140.79,80.2c0,2.44-1.01,4.4-3.04,5.91s-4.76,2.26-8.19,2.26h-4.26l-2.87,11.32h2.91v1.02h-9.2v-1.03h2.39l6.36-24.74h-2.96v-1.03h10.42c2.73,0,4.82.54,6.26,1.62,1.45,1.08,2.17,2.63,2.17,4.66h0ZM136.62,78.66c0-1.32-.38-2.27-1.13-2.85-.76-.58-1.99-.87-3.69-.87h-3.04l-3.14,12.38h3.29c2.38,0,4.26-.76,5.65-2.31,1.38-1.54,2.07-3.66,2.07-6.36h0Z"/>
                    <path class="cls-1" d="M151.33,73.55l-6.73,24.12c-.11.34-.16.67-.16,1.01,0,.64.28.96.85.96,1.35,0,2.77-1.56,4.26-4.68l.81.37c-1.7,3.94-3.68,5.91-5.92,5.91-.89,0-1.58-.21-2.07-.62s-.73-1.02-.73-1.82c0-.36.13-1.02.38-1.99l6.06-22.04h-3.2v-.86c1.41,0,2.47-.02,3.2-.06s1.81-.14,3.24-.31h0Z"/>
                    <path class="cls-1" d="M170.59,95.21c-1.43,4.02-3.36,6.03-5.8,6.03-1.65,0-2.47-.94-2.47-2.83-1.27,1.89-2.91,2.83-4.91,2.83-1.46,0-2.66-.53-3.59-1.59s-1.4-2.47-1.4-4.23c0-2.45,1.03-4.84,3.08-7.17,2.05-2.34,4.13-3.5,6.24-3.5,1.95,0,3.13.89,3.57,2.67l.69-2.3h2.84l-3.12,10.9c-.43,1.54-.65,2.5-.65,2.88,0,.58.24.86.73.86,1.4,0,2.72-1.61,3.93-4.84l.85.29h0ZM164.51,88.45c0-1.89-.84-2.84-2.51-2.84-1.46,0-2.81,1.11-4.05,3.33-.81,1.48-1.43,2.97-1.86,4.48-.43,1.51-.65,2.78-.65,3.83,0,.96.22,1.69.65,2.2.43.51,1.05.76,1.86.76,1.76,0,3.23-1.19,4.42-3.58.46-.93,1-2.56,1.62-4.9.35-1.34.53-2.44.53-3.29h0Z"/>
                    <path class="cls-1" d="M181.78,85.98h-3.27l-3.3,12.02c-.13.34-.2.63-.2.88,0,.51.31.76.94.76,1.25,0,2.71-1.68,4.37-5.05l.82.37c-1.86,4.18-3.93,6.28-6.2,6.28-.81,0-1.47-.21-1.97-.64s-.75-.99-.75-1.68c0-.44.11-1.06.31-1.87l3.12-11.08h-2.66v-.86h2.94l1.17-4.35h2.92l-1.18,4.35h2.95v.86h0Z"/>
                    <path class="cls-1" d="M199.82,75.93c0,1.15-.49,1.72-1.46,1.72-1.14,0-1.7-.49-1.7-1.48,0-.33.04-.57.12-.74.08-.16.16-.31.24-.45,0-.33-.24-.49-.73-.49-2.11,0-4.01,3.54-5.72,10.63h3.61v.94h-3.85l-1.86,7.1c-1.54,5.85-2.97,9.93-4.3,12.23-1.57,2.71-3.54,4.06-5.92,4.06-.87,0-1.57-.22-2.11-.66s-.81-.98-.81-1.64c0-1.12.54-1.68,1.62-1.68.97,0,1.46.46,1.46,1.39,0,.27-.06.53-.18.78s-.18.41-.18.49c0,.27.26.41.77.41,1.32,0,2.46-.93,3.41-2.79.38-.74.8-2.11,1.28-4.12.47-2.01.98-4.19,1.52-6.54.54-2.35,1.3-5.36,2.27-9.03h-3.24v-.94h3.53c2.08-7.71,5.15-11.57,9.2-11.57.95,0,1.69.22,2.23.66s.81,1.01.81,1.72h-.01Z"/>
                    <path class="cls-1" d="M209.59,91.04c0,2.19-.81,4.35-2.43,6.46-1.95,2.5-4.34,3.74-7.18,3.74-1.7,0-3.12-.57-4.24-1.71-1.12-1.14-1.68-2.53-1.68-4.18,0-2.22.81-4.39,2.43-6.5,2.11-2.74,4.53-4.11,7.26-4.11,1.73,0,3.13.58,4.22,1.73,1.08,1.15,1.62,2.67,1.62,4.56h0ZM206.34,88.66c0-2.08-.91-3.13-2.72-3.13-.89,0-1.66.19-2.31.58-.65.38-1.2,1-1.66,1.85-.22.41-.45.93-.69,1.54-.24.62-.53,1.54-.85,2.78-.59,2.19-.89,3.85-.89,4.98,0,2.06.97,3.09,2.92,3.09.95,0,1.78-.25,2.49-.74.72-.49,1.28-1.19,1.68-2.1.68-1.51,1.18-3.04,1.52-4.61.34-1.56.51-2.98.51-4.24h0Z"/>
                    <path class="cls-1" d="M224.95,86.19c0,1.15-.55,1.72-1.65,1.72-.48,0-.92-.2-1.31-.59-.39-.4-.63-.6-.71-.6-.65,0-1.41.68-2.3,2.05-1.02,1.59-1.82,3.56-2.38,5.92l-1.45,6.03h-2.92l3.65-14.74h-2.84v-.86c.76,0,1.61,0,2.53-.02.93-.02,2.1-.15,3.51-.42l-1.16,4.34c.97-1.51,1.85-2.61,2.65-3.31.79-.7,1.62-1.05,2.49-1.05.57,0,1.02.15,1.37.45.35.3.53.66.53,1.07h0Z"/>
                    <path class="cls-1" d="M252.52,95.38c-1.3,3.91-3.26,5.87-5.88,5.87-1.59,0-2.39-.75-2.39-2.26,0-.49.14-1.22.41-2.17l2.28-7.95c.15-.69.22-1.22.22-1.6,0-.85-.53-1.27-1.58-1.27s-2.2.59-3.37,1.78-1.97,2.62-2.4,4.28l-2.28,8.66h-2.94l3-11.4c.05-.25.13-.55.22-.91s.14-.67.14-.91c0-1-.55-1.5-1.66-1.5s-2.16.59-3.3,1.76c-1.15,1.17-1.92,2.53-2.33,4.07l-2.38,8.91h-2.93l3.8-14.73h-2.99v-.86c2.16,0,4.24-.12,6.27-.37l-1.01,3.77c1.83-2.52,3.79-3.77,5.86-3.77,2.24,0,3.36,1.03,3.36,3.08v.74c1.7-2.54,3.66-3.81,5.88-3.81,1.11,0,1.96.25,2.55.74s.89,1.18.89,2.05c0,.55-.07,1.09-.2,1.64l-2.55,9.07c-.11.38-.16.68-.16.9,0,.41.24.62.73.62,1.32,0,2.66-1.57,4.01-4.72l.73.33v-.04Z"/>
                    <path class="cls-1" d="M287.87,73.92l-1.66,6.89h-1.01c.11-.61.17-1.04.18-1.3.01-.26.02-.47.02-.64,0-1.76-.51-2.89-1.54-3.39-.76-.36-2.46-.54-5.11-.54h-2.92l-2.84,11.2.77.04c3.06,0,5.03-1.4,5.92-4.19h1.1l-2.64,10.38h-1.05l.16-1.85c0-1.2-.31-2.04-.94-2.5-.62-.46-1.68-.7-3.18-.7h-.45l-3.14,12.35h3.04v1.03h-9.24v-1.03h2.35l6.28-24.74h-2.92v-1.03h18.81v.02Z"/>
                    <path class="cls-1" d="M297.47,91.04c0,2.19-.81,4.35-2.43,6.46-1.95,2.5-4.34,3.74-7.18,3.74-1.7,0-3.12-.57-4.24-1.71s-1.68-2.53-1.68-4.18c0-2.22.81-4.39,2.43-6.5,2.11-2.74,4.53-4.11,7.26-4.11,1.73,0,3.13.58,4.22,1.73,1.08,1.15,1.62,2.67,1.62,4.56h0ZM294.23,88.66c0-2.08-.91-3.13-2.72-3.13-.89,0-1.66.19-2.31.58-.65.38-1.2,1-1.66,1.85-.22.41-.45.93-.69,1.54-.24.62-.53,1.54-.85,2.78-.59,2.19-.89,3.85-.89,4.98,0,2.06.97,3.09,2.92,3.09.95,0,1.78-.25,2.49-.74.72-.49,1.28-1.19,1.68-2.1.67-1.51,1.18-3.04,1.52-4.61.34-1.56.51-2.98.51-4.24h0Z"/>
                    <path class="cls-1" d="M312.84,86.19c0,1.15-.55,1.72-1.65,1.72-.48,0-.92-.2-1.31-.59-.39-.4-.63-.6-.71-.6-.65,0-1.41.68-2.3,2.05-1.02,1.59-1.82,3.56-2.38,5.92l-1.45,6.03h-2.92l3.65-14.74h-2.84v-.86c.76,0,1.61,0,2.53-.02.93-.02,2.1-.15,3.51-.42l-1.16,4.34c.97-1.51,1.85-2.61,2.65-3.31.79-.7,1.62-1.05,2.49-1.05.57,0,1.02.15,1.37.45.35.3.53.66.53,1.07h0Z"/>
                    <path class="cls-1" d="M346.89,73.92l-1.66,6.89h-1.01c.11-.61.17-1.04.18-1.3.01-.26.02-.47.02-.64,0-1.76-.51-2.89-1.54-3.39-.76-.36-2.46-.54-5.11-.54h-2.92l-2.84,11.2.77.04c3.06,0,5.03-1.4,5.92-4.19h1.1l-2.64,10.38h-1.05l.16-1.85c0-1.2-.31-2.04-.94-2.5-.62-.46-1.68-.7-3.18-.7h-.45l-3.14,12.35h3.04v1.03h-9.24v-1.03h2.35l6.28-24.74h-2.92v-1.03h18.81v.02Z"/>
                    <path class="cls-1" d="M356.5,91.04c0,2.19-.81,4.35-2.43,6.46-1.95,2.5-4.34,3.74-7.18,3.74-1.7,0-3.11-.57-4.24-1.71-1.12-1.14-1.68-2.53-1.68-4.18,0-2.22.81-4.39,2.43-6.5,2.11-2.74,4.53-4.11,7.26-4.11,1.73,0,3.13.58,4.22,1.73,1.08,1.15,1.62,2.67,1.62,4.56h0ZM353.26,88.66c0-2.08-.91-3.13-2.72-3.13-.89,0-1.66.19-2.31.58-.65.38-1.2,1-1.66,1.85-.22.41-.45.93-.69,1.54-.24.62-.53,1.54-.85,2.78-.59,2.19-.89,3.85-.89,4.98,0,2.06.97,3.09,2.92,3.09.95,0,1.78-.25,2.49-.74.72-.49,1.28-1.19,1.68-2.1.68-1.51,1.18-3.04,1.52-4.61.34-1.56.51-2.98.51-4.24h0Z"/>
                    <path class="cls-1" d="M377.42,95.46c-.6,1.86-1.39,3.29-2.38,4.29s-2.06,1.5-3.2,1.5c-.87,0-1.56-.21-2.08-.62s-.77-.94-.77-1.6l.12-1.52c-1.94,2.49-3.93,3.73-5.98,3.73-1.1,0-1.96-.24-2.56-.72-.61-.48-.91-1.15-.91-2,0-.3.08-.76.25-1.36l2.79-11.16h-3.03v-.87c2.38,0,4.46-.12,6.24-.37l-3.28,12.76-.16,1c0,.95.53,1.42,1.58,1.42,1.35,0,2.6-.68,3.74-2.04,1.14-1.36,2.04-3.32,2.72-5.87l1.83-6.89h2.89l-3.24,12.47c-.14.49-.2.9-.2,1.23,0,.63.31.94.93.94,1.35,0,2.66-1.55,3.93-4.64l.77.33h0Z"/>
                    <path class="cls-1" d="M397.61,95.34c-.73,1.98-1.55,3.46-2.48,4.44-.93.98-2.04,1.47-3.33,1.47-.78,0-1.41-.2-1.88-.6s-.71-.94-.71-1.6c0-.47.07-1.05.2-1.75l2.41-8.4.26-1.33c0-1.05-.57-1.57-1.7-1.57s-2.3.62-3.5,1.86-2.06,2.82-2.57,4.75l-2.14,8.12h-2.97l3.81-14.73h-3v-.86c1.89,0,3.13-.02,3.73-.06.59-.04,1.45-.14,2.55-.31l-1.01,3.81c1.76-2.54,3.76-3.81,6-3.81,1.13,0,2.04.26,2.72.77.68.51,1.01,1.22,1.01,2.11,0,.22-.03.48-.08.79s-.12.63-.2.96l-2.59,9.03-.12.59c0,.51.27.76.81.76,1.38,0,2.72-1.59,4.01-4.76l.77.33h0Z"/>
                    <path class="cls-1" d="M418.56,73.55l-6.73,24.25c-.14.42-.2.73-.2.92,0,.67.34,1.01,1.01,1.01s1.34-.43,2.07-1.28c.73-.86,1.39-2.11,1.99-3.76l.93.37c-1.51,4.13-3.45,6.19-5.8,6.19-1.73,0-2.59-.86-2.59-2.58v-.21c-1.35,1.86-2.99,2.79-4.91,2.79-1.43,0-2.66-.55-3.67-1.66-1.01-1.1-1.52-2.49-1.52-4.15,0-2.35.96-4.68,2.89-7,2.03-2.46,4.22-3.68,6.55-3.68,1.71,0,2.86.66,3.46,1.98l3.27-11.94h-3.28v-.87c2.32,0,4.5-.12,6.53-.37h0ZM411.31,88.23c0-1.77-.85-2.66-2.55-2.66s-2.99,1.05-4.09,3.15c-.19.38-.43.94-.71,1.68s-.53,1.49-.75,2.25c-.62,2.18-.93,3.71-.93,4.58,0,1.99.86,2.99,2.59,2.99,2,0,3.57-1.46,4.7-4.38.57-1.42,1-2.88,1.3-4.4.3-1.51.45-2.58.45-3.21h-.01Z"/>
                </svg>
            </div>
        </div>
        

        <div class="right-menu">

            {% if user.is_authenticated %}
            <!-- Logged in: Show My Page button -->
            <div class="mypage-btn" onclick="location.href='{% url 'mypage' %}'">
                <svg class="mypage-icon" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.24279 6.8065C9.09527 6.8065 9.91284 6.46786 10.5156 5.86506C11.1184 5.26226 11.4571 4.4447 11.4571 3.59222C11.4571 2.73973 11.1184 1.92217 10.5156 1.31937C9.91284 0.716577 9.09527 0.37793 8.24279 0.37793C7.39031 0.37793 6.57274 0.716577 5.96994 1.31937C5.36715 1.92217 5.0285 2.73973 5.0285 3.59222C5.0285 4.4447 5.36715 5.26226 5.96994 5.86506C6.57274 6.46786 7.39031 6.8065 8.24279 6.8065ZM0.742787 16.4494C0.742787 15.4644 0.936781 14.4892 1.31369 13.5792C1.6906 12.6693 2.24305 11.8425 2.93949 11.1461C3.63593 10.4496 4.46272 9.89717 5.37266 9.52026C6.2826 9.14335 7.25787 8.94936 8.24279 8.94936C9.2277 8.94936 10.203 9.14335 11.1129 9.52026C12.0229 9.89717 12.8496 10.4496 13.5461 11.1461C14.2425 11.8425 14.795 12.6693 15.1719 13.5792C15.5488 14.4892 15.7428 15.4644 15.7428 16.4494H0.742787Z" fill="#889DC4"/>
                </svg>
                <div class="mypage-btn-text">마이 페이지</div>  
            </div>

            {% else %}
            <!-- Not logged in: Show Naver Login button -->
            <div class="login-btn" onclick="location.href='{% url 'naver_login' %}'">
                <svg class="naver-icon" xmlns="http://www.w3.org/2000/svg" width="17" height="16" viewBox="0 0 17 16" fill="none">
                    <path d="M11.8212 8.56186L5.88885 0.0664062H0.973938V15.9211H6.12674V7.43886L12.059 15.9211H16.9739V0.0664062H11.8212V8.56186Z" fill="#03C75A"/>                    
                </svg>
                <div class="login-btn-text">네이버 로그인</div>
            </div>

            {% endif %}
            <!-- Payment button (always shown) -->
            <button class="payment-btn" onclick="location.href='{% url 'payplan' %}'" style="cursor: pointer;">
                <svg class="payment-icon" width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11.7339 0.200195L13.2023 7.40581L18.9589 2.82986L15.452 9.29355L22.8032 9.48839L15.962 12.1857L21.4681 17.0602L14.4936 14.7291L15.5782 22.0023L11.7339 15.7335L7.88962 22.0023L8.97425 14.7291L1.9998 17.0602L7.50585 12.1857L0.664688 9.48839L8.01582 9.29355L4.50899 2.82986L10.2655 7.40581L11.7339 0.200195Z" fill="#889DC4"/>
                </svg>
                <div class="payment-btn-text">유료플랜</div>
            </button>
        </div>
    </div>

    <div class="main-content">

        {% if user.is_authenticated %}
        <!------------ 좌측패널 ------------------------------>
        <div class="history-pannel-block">
            <button class="icon-block">
                <svg width="20" height="16" viewBox="0 0 22 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 1.03516H21M1 8.53516H21M1 16.0352H9.75" stroke="#617DAE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>                        
            </button>

            <div class="history-list-area">
                <div class="history-list">
                    <a>
                        지난 대화 기록
                    </a>
                    {% if user.is_authenticated %}
                        {% for session in user.chat_sessions.all|dictsortreversed:"created_at" %}
                            <p class="history-item" data-url="{{ session.get_absolute_url }}">
                                {{ session.get_first_message }}
                            </p>
                        {% empty %}
                            <p>아직 대화 기록이 없습니다.</p>
                        {% endfor %}
                    {% else %}
                        <p>
                            로그인하여 대화 기록을 확인하세요.
                        </p>
                    {% endif %}
                </div>
            </div>    
        </div>
        {% endif %}


        <div class="main-block">
            {% if user.nickname %}
            <div class="title">{{ user.nickname }}님 안녕하세요</div>
            {% else %}
            <div class="title">안녕하세요 창플 AI입니다</div>
            {% endif %}
            <div class="suggestions">
                <div class="suggestion-box" id="suggestion-box-1">카페 창업시 준비해야 할 기본적인 것들은 무엇이 있나요?</div>
                <div class="suggestion-box" id="suggestion-box-2">창플의 창업 철학에 대해 얘기해줘</div>
                <div class="suggestion-box" id="suggestion-box-3">소규모 창업을 하려는데, 구체적인 창업 비용과 항목 별 금액도 알 수 있나요?</div>
            </div>

            {% if user.is_authenticated %}
            <!-- Input unlocked for logged in users -->
            <div class="input-container-unlocked">
                <textarea class="input-box-unlocked" placeholder="오늘 어떤 도움을 드릴까요?" autofocus rows="1"></textarea>
                
                <!-- Changple icon (when input is empty) -->
                <div class="changple-btn">
                    <svg class="changple-icon" width="30" height="34" viewBox="0 0 30 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.0019 26.0245C18.6708 26.0245 20.3233 25.6958 21.8651 25.0572C23.4069 24.4186 24.8078 23.4825 25.9879 22.3024C27.1679 21.1224 28.104 19.7215 28.7427 18.1796C29.3813 16.6378 29.71 14.9853 29.71 13.3165C29.71 11.6476 29.3813 9.99512 28.7427 8.4533C28.104 6.91149 27.1679 5.51056 25.9879 4.33051C24.8078 3.15045 23.4069 2.21438 21.8651 1.57574C20.3233 0.937102 18.6708 0.608398 17.0019 0.608398L17.0019 13.3165L17.0019 26.0245Z" fill="#90A4C8"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M17 0.608398H0.290001V33.8249H17V26.0245C17 26.0245 17 26.0245 17 26.0245L17 13.3165V0.608402C17 0.608402 17 0.608398 17 0.608398ZM17 0.608398V26.0245C15.3312 26.0245 13.6787 25.6958 12.1369 25.0572C10.5951 24.4186 9.19414 23.4825 8.01408 22.3024C6.83403 21.1224 5.89796 19.7215 5.25932 18.1796C4.62068 16.6378 4.29197 14.9853 4.29197 13.3165C4.29197 11.6476 4.62068 9.99512 5.25932 8.45331C5.89796 6.91149 6.83403 5.51056 8.01408 4.33051C9.19413 3.15046 10.5951 2.21439 12.1369 1.57575C13.6787 0.937108 15.3312 0.608401 17 0.608398Z" fill="#90A4C8"/>
                    </svg>
                </div>

                <!-- Send button -->
                <div class="send-btn">
                    <svg class="send-icon" width="23" height="26" viewBox="0 0 23 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.03659 12.7966C0.741862 12.5018 0.576294 12.102 0.576294 11.6852C0.576294 11.2683 0.741862 10.8685 1.03659 10.5737L10.4693 1.14096C10.7641 0.846232 11.1639 0.680664 11.5808 0.680664C11.9977 0.680664 12.3975 0.846232 12.6923 1.14096L22.125 10.5737C22.4114 10.8702 22.5698 11.2673 22.5662 11.6795C22.5627 12.0917 22.3973 12.486 22.1058 12.7775C21.8143 13.069 21.42 13.2343 21.0078 13.2379C20.5956 13.2415 20.1985 13.083 19.902 12.7966L13.1529 6.04754V24.2621C13.1529 24.679 12.9873 25.0789 12.6924 25.3738C12.3976 25.6686 11.9977 25.8342 11.5808 25.8342C11.1638 25.8342 10.764 25.6686 10.4691 25.3738C10.1743 25.0789 10.0087 24.679 10.0087 24.2621V6.04754L3.25956 12.7966C2.96475 13.0914 2.56495 13.2569 2.14808 13.2569C1.73121 13.2569 1.3314 13.0914 1.03659 12.7966Z" fill="#617DAE"/>
                    </svg>
                </div>
            </div>

            {% else %}
            <!-- Input locked for non-logged in users -->
            <div class="input-container-locked">
                <div class="input-box-locked">우측 상단에서 로그인 후 이용해 주세요.</div>
                <div class="locked-btn">
                    <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="27" height="30" viewBox="0 0 27 30" fill="none">
                        <path d="M13.4574 19.9639V22.9639M4.4574 28.9639H22.4574C23.253 28.9639 24.0161 28.6478 24.5787 28.0852C25.1413 27.5226 25.4574 26.7595 25.4574 25.9639V16.9639C25.4574 16.1682 25.1413 15.4052 24.5787 14.8425C24.0161 14.2799 23.253 13.9639 22.4574 13.9639H4.4574C3.66175 13.9639 2.89869 14.2799 2.33608 14.8425C1.77347 15.4052 1.4574 16.1682 1.4574 16.9639V25.9639C1.4574 26.7595 1.77347 27.5226 2.33608 28.0852C2.89869 28.6478 3.66175 28.9639 4.4574 28.9639ZM19.4574 13.9639V7.96387C19.4574 6.37257 18.8253 4.84644 17.7 3.72123C16.5748 2.59601 15.0487 1.96387 13.4574 1.96387C11.8661 1.96387 10.34 2.59601 9.21476 3.72123C8.08954 4.84644 7.4574 6.37257 7.4574 7.96387V13.9639H19.4574Z" stroke="#90A4C8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            {% endif %}
        </div>


        <div class="help-btn">
            <p>?</p>
        </div>

        <div id="help-box" class="help-box" style="background-color: rgba(255, 255, 255, 0.9);">
            <div class="help-box-naver">
                <svg width="26" height="26" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M23.9999 47.5111C36.7606 47.5111 47.1051 37.1666 47.1051 24.4059C47.1051 11.6453 36.7606 1.30078 23.9999 1.30078C11.2393 1.30078 0.894775 11.6453 0.894775 24.4059C0.894775 37.1666 11.2393 47.5111 23.9999 47.5111Z" fill="#617DAE"/>
                    <path d="M11.6393 13.4766H20.2404C20.2404 13.4766 28.0528 25.277 28.2835 25.5934C28.5198 25.9131 28.5472 25.5934 28.5472 25.5934C28.1868 23.7674 27.7957 22.9478 27.7957 20.0266V13.4766H36.3606V35.3372H27.7957C27.7957 35.3372 20.1437 24.1663 19.913 23.8576C19.6811 23.5467 19.6504 23.8576 19.6504 23.8576C19.9448 25.3649 20.2052 25.6165 20.2052 28.2346V35.3373H11.6392L11.6393 13.4766Z" fill="white"/>
                </svg>
                <a href="https://cafe.naver.com/cjdckddus" target="_blank" class="styled-link">
                    창플 네이버카페
                </a>
            </div>
            <div class="help-box-naver-blog">
                <svg width="26" height="26" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M23.9999 47.5111C36.7606 47.5111 47.1051 37.1666 47.1051 24.4059C47.1051 11.6453 36.7606 1.30078 23.9999 1.30078C11.2393 1.30078 0.894775 11.6453 0.894775 24.4059C0.894775 37.1666 11.2393 47.5111 23.9999 47.5111Z" fill="#617DAE"/>
                    <path d="M11.6393 13.4766H20.2404C20.2404 13.4766 28.0528 25.277 28.2835 25.5934C28.5198 25.9131 28.5472 25.5934 28.5472 25.5934C28.1868 23.7674 27.7957 22.9478 27.7957 20.0266V13.4766H36.3606V35.3372H27.7957C27.7957 35.3372 20.1437 24.1663 19.913 23.8576C19.6811 23.5467 19.6504 23.8576 19.6504 23.8576C19.9448 25.3649 20.2052 25.6165 20.2052 28.2346V35.3373H11.6392L11.6393 13.4766Z" fill="white"/>
                </svg>
                <a href="https://blog.naver.com/changple123" target="_blank" class="styled-link">
                    창플 브랜드 블로그
                </a>
            </div>
            <div class="help-box-insta">
                <svg width="26" height="26" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_1063_220)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 24.4062C0 11.1515 10.7452 0.40625 24 0.40625C37.2548 0.40625 48 11.1515 48 24.4062C48 37.661 37.2548 48.4062 24 48.4062C10.7452 48.4062 0 37.661 0 24.4062ZM24.0012 11.6062C20.5249 11.6062 20.0886 11.6214 18.7233 11.6835C17.3606 11.7459 16.4305 11.9617 15.6166 12.2782C14.7747 12.6051 14.0606 13.0425 13.3491 13.7542C12.6371 14.4657 12.1997 15.1799 11.8717 16.0215C11.5544 16.8357 11.3384 17.7661 11.2771 19.1282C11.216 20.4936 11.2 20.93 11.2 24.4063C11.2 27.8826 11.2155 28.3176 11.2773 29.6829C11.34 31.0456 11.5557 31.9757 11.872 32.7896C12.1992 33.6315 12.6365 34.3457 13.3483 35.0572C14.0595 35.7692 14.7736 36.2075 15.615 36.5345C16.4294 36.851 17.3598 37.0668 18.7222 37.1292C20.0876 37.1914 20.5236 37.2066 23.9996 37.2066C27.4762 37.2066 27.9111 37.1914 29.2765 37.1292C30.6391 37.0668 31.5703 36.851 32.3848 36.5345C33.2264 36.2075 33.9394 35.7692 34.6506 35.0572C35.3626 34.3457 35.8 33.6316 36.128 32.79C36.4427 31.9758 36.6587 31.0454 36.7227 29.6833C36.784 28.3179 36.8 27.8826 36.8 24.4063C36.8 20.93 36.784 20.4939 36.7227 19.1285C36.6587 17.7658 36.4427 16.8357 36.128 16.0218C35.8 15.1799 35.3626 14.4657 34.6506 13.7542C33.9386 13.0422 33.2266 12.6049 32.384 12.2782C31.5679 11.9617 30.6373 11.7459 29.2746 11.6835C27.9092 11.6214 27.4746 11.6062 23.9972 11.6062H24.0012Z" fill="#617DAE"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M22.8529 13.9134C23.1937 13.9129 23.574 13.9134 24.0012 13.9134C27.4188 13.9134 27.8239 13.9257 29.1735 13.987C30.4215 14.0441 31.0989 14.2526 31.5501 14.4278C32.1474 14.6598 32.5733 14.9371 33.021 15.3851C33.469 15.8331 33.7464 16.2598 33.9789 16.8572C34.1541 17.3078 34.3629 17.9852 34.4197 19.2332C34.481 20.5825 34.4944 20.9879 34.4944 24.4039C34.4944 27.8199 34.481 28.2253 34.4197 29.5746C34.3626 30.8226 34.1541 31.5 33.9789 31.9506C33.7469 32.548 33.469 32.9733 33.021 33.4211C32.573 33.8691 32.1477 34.1464 31.5501 34.3784C31.0994 34.5544 30.4215 34.7624 29.1735 34.8195C27.8242 34.8808 27.4188 34.8941 24.0012 34.8941C20.5833 34.8941 20.1782 34.8808 18.8289 34.8195C17.5809 34.7619 16.9035 34.5533 16.4521 34.3781C15.8547 34.1461 15.428 33.8688 14.98 33.4208C14.532 32.9728 14.2547 32.5472 14.0222 31.9496C13.847 31.4989 13.6382 30.8216 13.5814 29.5736C13.52 28.2242 13.5078 27.8189 13.5078 24.4007C13.5078 20.9825 13.52 20.5793 13.5814 19.23C13.6384 17.982 13.847 17.3046 14.0222 16.8534C14.2542 16.2561 14.532 15.8294 14.98 15.3814C15.428 14.9334 15.8547 14.6561 16.4521 14.4235C16.9033 14.2475 17.5809 14.0395 18.8289 13.9822C20.0097 13.9289 20.4673 13.9129 22.8529 13.9102V13.9134ZM30.8338 16.0387C29.9858 16.0387 29.2978 16.726 29.2978 17.5742C29.2978 18.4222 29.9858 19.1102 30.8338 19.1102C31.6818 19.1102 32.3698 18.4222 32.3698 17.5742C32.3698 16.7262 31.6818 16.0387 30.8338 16.0387ZM24.0012 17.8334C20.371 17.8334 17.4278 20.7767 17.4278 24.4068C17.4278 28.037 20.371 30.9789 24.0012 30.9789C27.6314 30.9789 30.5735 28.037 30.5735 24.4068C30.5735 20.7767 27.6314 17.8334 24.0012 17.8334Z" fill="#617DAE"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M24.0012 20.1406C26.3575 20.1406 28.2679 22.0508 28.2679 24.4073C28.2679 26.7636 26.3575 28.674 24.0012 28.674C21.6446 28.674 19.7345 26.7636 19.7345 24.4073C19.7345 22.0508 21.6446 20.1406 24.0012 20.1406Z" fill="#617DAE"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_1063_220">
                    <rect width="48" height="48" fill="white" transform="translate(0 0.40625)"/>
                    </clipPath>
                    </defs>
                    </svg>
                <a href="https://www.instagram.com/changple_official/" target="_blank" class="styled-link">
                    창플 instagram
                </a>
            </div>
            <div class="help-box-youtube">
                <svg width="26" height="26" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_1063_229)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 24.4062C0 11.1515 10.7452 0.40625 24 0.40625C37.2548 0.40625 48 11.1515 48 24.4062C48 37.661 37.2548 48.4062 24 48.4062C10.7452 48.4062 0 37.661 0 24.4062ZM36.265 18.4795C35.9706 17.3485 35.1031 16.4579 34.0016 16.1556C32.0054 15.6062 24 15.6062 24 15.6062C24 15.6062 15.9946 15.6062 13.9983 16.1556C12.8967 16.4579 12.0292 17.3485 11.7348 18.4795C11.2 20.5293 11.2 24.8062 11.2 24.8062C11.2 24.8062 11.2 29.0831 11.7348 31.1331C12.0292 32.2641 12.8967 33.1547 13.9983 33.4571C15.9946 34.0063 24 34.0062 24 34.0062C24 34.0062 32.0054 34.0063 34.0016 33.4571C35.1031 33.1547 35.9706 32.2641 36.265 31.1331C36.8 29.0831 36.8 24.8062 36.8 24.8062C36.8 24.8062 36.8 20.5293 36.265 18.4795Z" fill="#617DAE"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M21.6 29.207V21.207L28 25.2071L21.6 29.207Z" fill="#617DAE"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_1063_229">
                    <rect width="48" height="48" fill="white" transform="translate(0 0.40625)"/>
                    </clipPath>
                    </defs>
                    </svg>
                <a href="https://www.youtube.com/@TV-ib4ns" target="_blank" class="styled-link">
                    창플tv
                </a>
            </div>
            <div class="help-box-youtube2">
                <svg width="26" height="26" viewBox="0 0 48 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_1063_229)">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 24.4062C0 11.1515 10.7452 0.40625 24 0.40625C37.2548 0.40625 48 11.1515 48 24.4062C48 37.661 37.2548 48.4062 24 48.4062C10.7452 48.4062 0 37.661 0 24.4062ZM36.265 18.4795C35.9706 17.3485 35.1031 16.4579 34.0016 16.1556C32.0054 15.6062 24 15.6062 24 15.6062C24 15.6062 15.9946 15.6062 13.9983 16.1556C12.8967 16.4579 12.0292 17.3485 11.7348 18.4795C11.2 20.5293 11.2 24.8062 11.2 24.8062C11.2 24.8062 11.2 29.0831 11.7348 31.1331C12.0292 32.2641 12.8967 33.1547 13.9983 33.4571C15.9946 34.0063 24 34.0062 24 34.0062C24 34.0062 32.0054 34.0063 34.0016 33.4571C35.1031 33.1547 35.9706 32.2641 36.265 31.1331C36.8 29.0831 36.8 24.8062 36.8 24.8062C36.8 24.8062 36.8 20.5293 36.265 18.4795Z" fill="#617DAE"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M21.6 29.207V21.207L28 25.2071L21.6 29.207Z" fill="#617DAE"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_1063_229">
                    <rect width="48" height="48" fill="white" transform="translate(0 0.40625)"/>
                    </clipPath>
                    </defs>
                </svg>
                <a href="https://www.youtube.com/@TV-wf6mg" target="_blank" class="styled-link">
                    창플비즈니스 tv
                </a>
            </div>
        </div>

    <footer>
        <div class="company-info">
            (주)창플 | 283-88-00641 | 한범구 | 서울 송파구 송파대로 167 (문정동)테라타워 B동, 707호 | 02-2054-3956 | tiger9@changple.com
        </div>
        <div class="copyright">
            <p>
                @Copyright @ ChangpleTeamBusiness Inc. All Rights Reserved. 
            </p>
            <p>
                <a href="/privacy/" class="personal-info-link" target="_blank">개인정보처리방침</a>
            </P>
        </div>
    </footer>
{% endblock %}

{% block extra_scripts %}
    {% csrf_token %}
    <script src="{% static 'js/index.js' %}"></script>
    <script>
        //---------좌측 창플로고 클릭시 index.html로 이동하는 기능 ----------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure help box is hidden initially
            const helpBox = document.getElementById('help-box');
            if (helpBox) {
                helpBox.classList.remove('visible');
            }
            
            // cp-logo-container 클릭 이벤트 리스너 추가
            const cpLogoContainer = document.getElementById('cp-logo');
            cpLogoContainer.addEventListener('click', function() {
                // 클릭 시 이동할 URL
                location.href = 'http{% if request.is_secure %}s{% endif %}://{{ ALLOWED_HOSTS }}{{ PORT }}/';
            });

            //---------- History items click event ------------------------------------------
            const historyItems = document.querySelectorAll('.history-item');
            historyItems.forEach(item => {
                item.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    if (url) {
                        window.location.href = url;
                    }
                });
                
                // Add cursor pointer to make it obvious it's clickable
                item.style.cursor = 'pointer';
            });
        });
        //-------------------------------------------------------------------------------

        //------------- Help Box 이벤트 리스너 추가 -------------------------------------
        const helpBtn = document.querySelector('.help-btn');
        const helpBox = document.getElementById('help-box');

        // Show or hide help box when help button is clicked
        helpBtn.addEventListener('click', function(event) {
            event.stopPropagation(); // Prevent the click from bubbling up to the document
            if (helpBox.classList.contains('visible')) {
                helpBox.classList.remove('visible'); // Hide the help box if it's already shown
            } else {
                helpBox.classList.add('visible'); // Show the help box
            }
        });

        // Hide help box when clicking anywhere else
        document.addEventListener('click', function() {
            helpBox.classList.remove('visible'); // Hide the help box
        });
        //-------------------------------------------------------------------------------


        //-----------------------------------------------------------------------------------------
        //-----------------------------------------------------------------------------------------
        //--------- inputbox와 관련된 기능들 모음 ----------------------------------------------------
        {% if user.is_authenticated %}
        document.addEventListener('DOMContentLoaded', function() {
            const inputBox = document.querySelector('.input-box-unlocked');
            const sendBtn = document.querySelector('.send-btn');
            const changpleBtn = document.querySelector('.changple-btn');
            
            // Reset input field state on page load
            inputBox.disabled = false;
            inputBox.placeholder = "오늘 어떤 도움을 드릴까요?";
            inputBox.value = "";
            
            // Show/hide the appropriate button based on input content
            inputBox.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    changpleBtn.style.display = 'none';
                    sendBtn.style.display = 'flex';
                } else {
                    changpleBtn.style.display = 'flex';
                    sendBtn.style.display = 'none';
                }
            });
            
            // Trigger input event to set initial state
            inputBox.dispatchEvent(new Event('input'));
            
            // Send button click event
            sendBtn.addEventListener('click', function() {
                sendChatMessage();
            });
            



                //----------------- input box 글자 입력시 다른 컬러로 나오는 기능 --------------------
                // 기본 텍스트 색상 설정
                inputBox.style.color = '#a4a4a4'; // 입력하기 전 회색으로 설정
                
                // Show/hide the appropriate button based on input content and change text color
                inputBox.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        changpleBtn.style.display = 'none';
                        sendBtn.style.display = 'flex';
                        this.style.color = '#47639A'; // 사용자가 텍스트를 입력하면 파란색으로 변경
                    } else {
                        changpleBtn.style.display = 'flex';
                        sendBtn.style.display = 'none';
                        this.style.color = '#a4a4a4'; // 텍스트가 없으면 다시 회색으로
                    }
                });
    



            // Enter key press event
            inputBox.addEventListener('keyup', function(event) {
                // Enter 키만 눌렸을 때 메시지 전송
                if (event.key === 'Enter' && !event.shiftKey) { 
                    // 기본 Enter 동작(줄바꿈) 방지
                    event.preventDefault(); 
                    sendChatMessage();
                }




            




            });
            
            // Message sending function
            function sendChatMessage() {
                const message = inputBox.value.trim();
                if (message) {
                    console.log("Sending message:", message);
                    
                    // Get CSRF token
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                    console.log("CSRF token obtained:", csrfToken ? "Yes" : "No");
                    
                    // Temporarily disable the input and buttons to prevent double submissions
                    inputBox.disabled = true;
                    if (sendBtn) sendBtn.style.pointerEvents = 'none';
                    if (changpleBtn) changpleBtn.style.pointerEvents = 'none';
                    
                    // Show a simple loading indicator
                    const originalPlaceholder = inputBox.placeholder;
                    inputBox.placeholder = "메시지 전송 중...";
                    
                    // Clear the input
                    const originalMessage = message;
                    inputBox.value = "";
                    inputBox.dispatchEvent(new Event('input'));
                    
                    // Simple approach - just use FormData
                    const formData = new FormData();
                    formData.append('message', originalMessage);
                    
                    fetch('/chat/', {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': csrfToken
                        },
                        body: formData
                    })
                    .then(response => {
                        console.log("Response status:", response.status);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Response data:", data);
                        if (data.error) {
                            alert(`오류가 발생했습니다: ${data.error}`);
                            // Re-enable input
                            inputBox.disabled = false;
                            inputBox.placeholder = originalPlaceholder;
                            if (sendBtn) sendBtn.style.pointerEvents = 'auto';
                            if (changpleBtn) changpleBtn.style.pointerEvents = 'auto';
                            return;
                        }
                        
                        if (data.redirect_url) {
                            // Redirect to the new session URL
                            console.log("Redirecting to:", data.redirect_url);
                            window.location.href = data.redirect_url;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert("요청 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
                        
                        // Re-enable input
                        inputBox.disabled = false;
                        inputBox.placeholder = originalPlaceholder;
                        if (sendBtn) sendBtn.style.pointerEvents = 'auto';
                        if (changpleBtn) changpleBtn.style.pointerEvents = 'auto';
                    });
                }
            }
            //-------------------------------------------------------------------------------

            
            //------- suggestion box 클릭시, text가 inputbox에 입력되도록 
            const suggestionBoxes = document.querySelectorAll('.suggestion-box');
            suggestionBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    inputBox.value = this.textContent;
                    inputBox.dispatchEvent(new Event('input'));
                });
            });
            //-------------------------------------------------------------------------------


            //-------- 좌측 히스토리 패널 : 열고 닫는 기능 ------------------------------------------------
            const buttons = document.querySelectorAll(".icon-block");
        
            buttons.forEach(button => {
                button.addEventListener("click", function () {
                    const panel = button.closest(".history-pannel-block");
                    const listArea = panel.querySelector(".history-list-area");
                    const historyList = panel.querySelector(".history-list");
        
                    if (listArea.style.display === "none" || listArea.style.display === "") {
                        // 보여주기
                        listArea.style.display = "flex";
                        panel.classList.remove("minimized"); // 전체 너비로
                        
                        // 스크롤 위치 초기화
                        listArea.scrollTop = 0;
                        panel.classList.remove("minimized");

                        
                        // 패널이 열린 후 스크롤이 작동하도록 약간의 지연 후 스크롤 이벤트 발생
                        setTimeout(() => {
                            listArea.dispatchEvent(new Event('scroll'));
                            
                            // 내용이 많을 경우 스크롤이 생기는지 확인
                            if (historyList.scrollHeight > listArea.clientHeight) {
                                console.log("스크롤이 필요합니다. 내용 높이:", historyList.scrollHeight, "컨테이너 높이:", listArea.clientHeight);
                            }
                        }, 100);
                    } else {
                        // 숨기기
                        listArea.style.display = "none";
                        panel.classList.add("minimized"); // 아이콘 너비로 축소
                    }
                });
        
                // 초기 상태: 숨김 + 축소
                const panel = button.closest(".history-pannel-block");
                const listArea = panel.querySelector(".history-list-area");
                listArea.style.display = "none";
                panel.classList.add("minimized");
            });
            //-------------------------------------------------------------------------------
        });



            //------------- 질문 예시 박스 3개 : mouseover 컬러 변경 -------------------------------
            const suggestionBoxes = document.querySelectorAll('.suggestion-box');
            
            // 모든 suggestion box에 호버 효과 적용
            if (suggestionBoxes && suggestionBoxes.length > 0) {
                suggestionBoxes.forEach(box => {
                    // 마우스가 div 위에 올라갔을 때
                    box.addEventListener('mouseover', function() {
                        this.style.backgroundColor = '#f5f5f5';
                        this.style.transition = 'background-color 0.3s ease';
                    });
                    
                    // 마우스가 div에서 벗어났을 때
                    box.addEventListener('mouseout', function() {
                        this.style.backgroundColor = '#FFFFFF';
                        this.style.transition = 'background-color 0.3s ease';
                    });
                });
            }
        {% endif %}

        
        //------input-box 안에 있는 '창플 앰블럼 버튼' : mouseover 컬러 변경 ------------------
        document.addEventListener('DOMContentLoaded', function() {
            // changple-btn 요소 선택
            const changpleBtn = document.querySelector('.changple-btn');
            
            // 요소가 존재하는 경우에만 이벤트 리스너 추가
            if (changpleBtn) {
                // 마우스가 버튼 위에 올라갔을 때 (mouseover)
                changpleBtn.addEventListener('mouseover', function() {
                    // 배경색 변경 (예: 연한 파란색)
                    this.style.backgroundColor = '#EFF2FA';
                    // 부드러운 전환 효과 추가
                    this.style.transition = 'background-color 0.3s ease';
                });
                
                // 마우스가 버튼에서 벗어났을 때 (mouseout)
                changpleBtn.addEventListener('mouseout', function() {
                    // 원래 배경색으로 복원 (투명 또는 흰색)
                    this.style.backgroundColor = 'transparent';
                });
            }
        });
        //-------------------------------------------------------------------------------



        //------input-box 안에 있는 'send 버튼' : mouseover 컬러 변경 ------------------
        document.addEventListener('DOMContentLoaded', function() {
            //-- send-btn 요소 선택
            const sendBtn = document.querySelector('.send-btn');
            
            //-- 요소가 존재하는 경우에만 이벤트 리스너 추가
            if (sendBtn) {
                //-- 마우스가 버튼 위에 올라갔을 때(mouseover)
                sendBtn.addEventListener('mouseover', function() {
                    //-- 배경색 변경
                    this.style.backgroundColor = '#EFF2FA';
                    //-- 전환효과 추가
                    this.style.transition = 'background-color 0.3 ease'; 
                });

                sendBtn.addEventListener('mouseout', function() {
                    //-- 원래 배경색으로 보원
                    this.style.backgroundColor = 'transparent';
                });
            }
        });
        //-------------------------------------------------------------------------------


        //----- 좌측 히스토리 패널 햄버거 아이콘 : mouseover 컬러 변경  --------------------------
        document.addEventListener('DOMContentLoaded', function() {
            // icon-block 요소 선택
            const iconBlock = document.querySelector('.icon-block');
            
            // 요소가 존재하는 경우에만 이벤트 리스너 추가
            if (iconBlock) {
                // 마우스가 버튼 위에 올라갔을 때 (mouseover)
                iconBlock.addEventListener('mouseover', function() {
                    // 배경색 변경 (예: 연한 파란색)
                    this.style.backgroundColor = '#EFF2FA';
                    // 부드러운 전환 효과 추가
                    this.style.transition = 'background-color 0.3s ease';
                });
                
                // 마우스가 버튼에서 벗어났을 때 (mouseout)
                iconBlock.addEventListener('mouseout', function() {
                    // 원래 배경색으로 복원 (투명 또는 흰색)
                    this.style.backgroundColor = 'transparent';
                });
            }
        });
        //-------------------------------------------------------------------------------
    </script>
    <script>
        // 메시지 수신 및 채팅창 업데이트 로직
        window.addEventListener('message', function(event) {
            // 보안을 위해 특정 origin만 허용하는 것이 좋지만, 여기서는 모든 origin을 허용합니다.
            // if (event.origin !== 'http://expected-origin.com') return;

            if (event.data && event.data.type === 'STW_ADD_TO_CHAT' && typeof event.data.text === 'string') {
                const inputBox = document.querySelector('.input-box-unlocked');
                if (inputBox) {
                    const selectedText = event.data.text;
                    // 기존 텍스트가 있으면 줄바꿈 후 추가, 없으면 그냥 추가
                    if (inputBox.value.trim().length > 0) {
                        inputBox.value += '\n' + selectedText;
                    } else {
                        inputBox.value = selectedText;
                    }
                    // UI 업데이트 (전송 버튼 표시 등)를 위해 input 이벤트 강제 발생
                    inputBox.dispatchEvent(new Event('input'));
                    // 사용자가 바로 다음 입력을 할 수 있도록 포커스 설정
                    inputBox.focus();
                }
            }
        });
    </script>
{% endblock %}